import{p as se,aA as pe,aB as he,g as ne,D as Ve,aC as be,aD as Pe,o as E,u as re,aE as xe,aF as ee,c as t,G as _,t as z,aG as we,q as ke,a5 as J,aH as Ce,aI as Se,x as g,s as Fe,H as Be,A as Te,z as j,B as De,aJ as Ie,aK as Re,T as ie,aL as Ae,aM as Me,aN as Ue,aO as He,ai as ae,aP as Ne,v as Ge,y as Ee,Y as _e,$ as $e,a0 as de,a1 as ze,a3 as f,aQ as qe,ab as Le,J as X,a8 as Z,ap as te,aR as Oe,V as je,a2 as Ke,a4 as Je,a7 as c,ao as We,ag as Qe,ac as Ye,aa as Xe,ae as Ze,af as ea,a9 as aa,an as ta,W as la}from"./index-a1a4f7b1.js";import{c as oa,a as le,e as sa,f as na,u as ra,d as K,V as ua}from"./index.esm-72701c7e.js";import{V as ia}from"./VContainer-9c18d28c.js";import{a as da,V as oe}from"./VRow-da36a333.js";import{V as ca}from"./VDivider-217783ab.js";import{m as va,V as ce,a as ma,b as fa,c as ga,d as pa,e as Va,f as ba,g as xa,u as ya,p as ha,h as Pa,i as wa,j as ka,k as Ca,l as Sa,n as Fa,o as ve,q as me,r as fe,s as ge,t as Ba}from"./VDataTable-ce6cd2cc.js";import"./VList-66a7070f.js";const Ta=se({...pe(),...he(va(),["inline"])},"VCheckbox"),Da=ne()({name:"VCheckbox",inheritAttrs:!1,props:Ta(),emits:{"update:modelValue":e=>!0,"update:focused":e=>!0},setup(e,R){let{attrs:S,slots:o}=R;const i=Ve(e,"modelValue"),{isFocused:r,focus:k,blur:U}=be(e),F=Pe(),A=E(()=>e.id||`checkbox-${F}`);return re(()=>{const[$,T]=xe(S),H=ee.filterProps(e),p=ce.filterProps(e);return t(ee,_({class:["v-checkbox",e.class]},$,H,{modelValue:i.value,"onUpdate:modelValue":b=>i.value=b,id:A.value,focused:r.value,style:e.style}),{...o,default:b=>{let{id:h,messagesId:D,isDisabled:C,isReadonly:x}=b;return t(ce,_(p,{id:h.value,"aria-describedby":D.value,disabled:C.value,readonly:x.value},T,{modelValue:i.value,"onUpdate:modelValue":N=>i.value=N,onFocus:k,onBlur:U}),o)}})}),{}}}),Ia=se({itemsLength:{type:[Number,String],required:!0},...ma(),...fa(),...ga()},"VDataTableServer"),Ra=ne()({name:"VDataTableServer",props:Ia(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0},setup(e,R){let{attrs:S,slots:o}=R;const{groupBy:i}=pa(e),{sortBy:r,multiSort:k,mustSort:U}=Va(e),{page:F,itemsPerPage:A}=ba(e),$=E(()=>parseInt(e.itemsLength,10)),{columns:T,headers:H}=xa(e,{groupBy:i,showSelect:z(e,"showSelect"),showExpand:z(e,"showExpand")}),{items:p}=ya(e,T),{toggleSort:b}=ha({sortBy:r,multiSort:k,mustSort:U,page:F}),{opened:h,isGroupOpen:D,toggleGroup:C,extractRows:x}=Pa({groupBy:i,sortBy:r}),{pageCount:N,setItemsPerPage:q}=wa({page:F,itemsPerPage:A,itemsLength:$}),{flatItems:G}=ka(p,i,h),{isSelected:P,select:B,selectAll:M,toggleSelect:I,someSelected:y,allSelected:n}=Ca(e,{allItems:p,currentPage:p}),{isExpanded:v,toggleExpand:d}=Sa(e),V=E(()=>x(p.value));Fa({page:F,itemsPerPage:A,sortBy:r,groupBy:i,search:z(e,"search")}),we("v-data-table",{toggleSort:b,sortBy:r}),ke({VDataTableRows:{hideNoData:z(e,"hideNoData"),noDataText:z(e,"noDataText"),loading:z(e,"loading"),loadingText:z(e,"loadingText")}});const s=E(()=>({page:F.value,itemsPerPage:A.value,sortBy:r.value,pageCount:N.value,toggleSort:b,setItemsPerPage:q,someSelected:y.value,allSelected:n.value,isSelected:P,select:B,selectAll:M,toggleSelect:I,isExpanded:v,toggleExpand:d,isGroupOpen:D,toggleGroup:C,items:V.value.map(l=>l.raw),internalItems:V.value,groupedItems:G.value,columns:T.value,headers:H.value}));re(()=>{const l=ve.filterProps(e),w=me.filterProps(e),a=fe.filterProps(e),u=ge.filterProps(e);return t(ge,_({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},u),{top:()=>{var m;return(m=o.top)==null?void 0:m.call(o,s.value)},default:()=>{var m,L,W,Q,Y,O;return o.default?o.default(s.value):t(J,null,[(m=o.colgroup)==null?void 0:m.call(o,s.value),t("thead",{class:"v-data-table__thead",role:"rowgroup"},[t(me,_(w,{sticky:e.fixedHeader}),o)]),(L=o.thead)==null?void 0:L.call(o,s.value),t("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[(W=o["body.prepend"])==null?void 0:W.call(o,s.value),o.body?o.body(s.value):t(fe,_(S,a,{items:G.value}),o),(Q=o["body.append"])==null?void 0:Q.call(o,s.value)]),(Y=o.tbody)==null?void 0:Y.call(o,s.value),(O=o.tfoot)==null?void 0:O.call(o,s.value)])},bottom:()=>o.bottom?o.bottom(s.value):t(ve,l,{prepend:o["footer.prepend"]})})})}});const Aa=se({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...pe(),...Ce()},"VTextarea"),Ma=ne()({name:"VTextarea",directives:{Intersect:Se},inheritAttrs:!1,props:Aa(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,R){let{attrs:S,emit:o,slots:i}=R;const r=Ve(e,"modelValue"),{isFocused:k,focus:U,blur:F}=be(e),A=E(()=>typeof e.counterValue=="function"?e.counterValue(r.value):(r.value||"").toString().length),$=E(()=>{if(S.maxlength)return S.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function T(n,v){var d,V;!e.autofocus||!n||(V=(d=v[0].target)==null?void 0:d.focus)==null||V.call(d)}const H=g(),p=g(),b=Fe(""),h=g(),D=E(()=>e.persistentPlaceholder||k.value||e.active);function C(){var n;h.value!==document.activeElement&&((n=h.value)==null||n.focus()),k.value||U()}function x(n){C(),o("click:control",n)}function N(n){o("mousedown:control",n)}function q(n){n.stopPropagation(),C(),ae(()=>{r.value="",Ne(e["onClick:clear"],n)})}function G(n){var d;const v=n.target;if(r.value=v.value,(d=e.modelModifiers)!=null&&d.trim){const V=[v.selectionStart,v.selectionEnd];ae(()=>{v.selectionStart=V[0],v.selectionEnd=V[1]})}}const P=g(),B=g(+e.rows),M=E(()=>["plain","underlined"].includes(e.variant));Be(()=>{e.autoGrow||(B.value=+e.rows)});function I(){e.autoGrow&&ae(()=>{if(!P.value||!p.value)return;const n=getComputedStyle(P.value),v=getComputedStyle(p.value.$el),d=parseFloat(n.getPropertyValue("--v-field-padding-top"))+parseFloat(n.getPropertyValue("--v-input-padding-top"))+parseFloat(n.getPropertyValue("--v-field-padding-bottom")),V=P.value.scrollHeight,s=parseFloat(n.lineHeight),l=Math.max(parseFloat(e.rows)*s+d,parseFloat(v.getPropertyValue("--v-input-control-height"))),w=parseFloat(e.maxRows)*s+d||1/0,a=Ee(V??0,l,w);B.value=Math.floor((a-d)/s),b.value=Ge(a)})}Te(I),j(r,I),j(()=>e.rows,I),j(()=>e.maxRows,I),j(()=>e.density,I);let y;return j(P,n=>{n?(y=new ResizeObserver(I),y.observe(P.value)):y==null||y.disconnect()}),De(()=>{y==null||y.disconnect()}),re(()=>{const n=!!(i.counter||e.counter||e.counterValue),v=!!(n||i.details),[d,V]=xe(S),{modelValue:s,...l}=ee.filterProps(e),w=Ie(e);return t(ee,_({ref:H,modelValue:r.value,"onUpdate:modelValue":a=>r.value=a,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":M.value},e.class],style:e.style},d,l,{centerAffix:B.value===1&&!M.value,focused:k.value}),{...i,default:a=>{let{id:u,isDisabled:m,isDirty:L,isReadonly:W,isValid:Q}=a;return t(Re,_({ref:p,style:{"--v-textarea-control-height":b.value},onClick:x,onMousedown:N,"onClick:clear":q,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},w,{id:u.value,active:D.value||L.value,centerAffix:B.value===1&&!M.value,dirty:L.value||e.dirty,disabled:m.value,focused:k.value,error:Q.value===!1}),{...i,default:Y=>{let{props:{class:O,...ue}}=Y;return t(J,null,[e.prefix&&t("span",{class:"v-text-field__prefix"},[e.prefix]),ie(t("textarea",_({ref:h,class:O,value:r.value,onInput:G,autofocus:e.autofocus,readonly:W.value,disabled:m.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:C,onBlur:F},ue,V),null),[[Ae("intersect"),{handler:T},null,{once:!0}]]),e.autoGrow&&ie(t("textarea",{class:[O,"v-textarea__sizer"],id:`${ue.id}-sizer`,"onUpdate:modelValue":ye=>r.value=ye,ref:P,readonly:!0,"aria-hidden":"true"},null),[[Me,r.value]]),e.suffix&&t("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:v?a=>{var u;return t(J,null,[(u=i.details)==null?void 0:u.call(i,a),n&&t(J,null,[t("span",null,null),t(Ue,{active:e.persistentCounter||k.value,value:A.value,max:$.value},i.counter)])])}:void 0})}),He({},H,p,h)}}),Ua=ta("h1",{class:"text-center"},"商品管理",-1),qa={__name:"ProductsView",setup(e){const{apiAuth:R}=Le(),S=_e(),o=g(null),i=g(!1),r=g(""),k=s=>{s?(r.value=s._id,p.value.value=s.name,b.value.value=s.price,h.value.value=s.description,D.value.value=s.category,C.value.value=s.sell):r.value="",i.value=!0},U=()=>{for(i.value=!1,H();x.value.length>0;)o.value.deleteFileRecord(x.value[0])},F=["營地轉讓","露營裝備"],A=oa({name:le().required("缺少商品名稱"),price:sa().typeError("商品價格格式錯誤").required("缺少商品價格").min(0,"商品價格不能小於 0"),description:le().required("缺少商品說明"),category:le().required("缺少商品分類").test("isCategory","商品分類錯誤",s=>F.includes(s)),sell:na()}),{handleSubmit:$,isSubmitting:T,resetForm:H}=ra({validationSchema:A,initialValues:{name:"",price:0,description:"",category:"",sell:!1}}),p=K("name"),b=K("price"),h=K("description"),D=K("category"),C=K("sell"),x=g([]),N=g([]),q=$(async s=>{var l,w,a;if(!((l=x.value[0])!=null&&l.error)&&!(r.value===""&&x.value.length===0))try{const u=new FormData;for(const m in s)u.append(m,s[m]);if(x.value.length>0)for(const m of x.value)u.append("image",m.file);r.value===""?await R.post("/products",u):await R.patch("/products/"+r.value,u),S({text:r.value===""?"新增成功":"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),U(),V()}catch(u){console.log(u);const m=((a=(w=u==null?void 0:u.response)==null?void 0:w.data)==null?void 0:a.message)||"發生錯誤，請稍後再試";S({text:m,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),G=g(10),P=g([{key:"createdAt",order:"desc"}]),B=g(1),M=g([]),I=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"名稱",align:"center",sortable:!0,key:"name"},{title:"價格",align:"center",sortable:!0,key:"price"},{title:"分類",align:"center",sortable:!0,key:"category"},{title:"上架",align:"center",sortable:!0,key:"sell"},{title:"編輯",align:"center",sortable:!1,key:"edit"}],y=g(!0),n=g(0),v=g(""),d=async()=>{var s,l,w,a;y.value=!0;try{const{data:u}=await R.get("/products/all",{params:{page:B.value,itemsPerPage:G.value,sortBy:((s=P.value[0])==null?void 0:s.key)||"createdAt",sortOrder:((l=P.value[0])==null?void 0:l.order)==="asc"?1:-1,search:v.value}});M.value.splice(0,M.value.length,...u.result.data),n.value=u.result.total}catch(u){console.log(u);const m=((a=(w=u==null?void 0:u.response)==null?void 0:w.data)==null?void 0:a.message)||"發生錯誤，請稍後再試";S({text:m,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}y.value=!1};d();const V=()=>{B.value=1,d()};return(s,l)=>{const w=$e("VueFileAgent");return de(),ze(J,null,[t(ia,null,{default:f(()=>[t(da,null,{default:f(()=>[t(oe,{cols:"12"},{default:f(()=>[Ua]),_:1}),t(ca),t(oe,{cols:"12"},{default:f(()=>[t(X,{color:"green",onClick:l[0]||(l[0]=a=>k())},{default:f(()=>[Z("新增商品")]),_:1}),t(oe,{cols:"12"}),t(Ra,{"items-per-page":G.value,"onUpdate:itemsPerPage":[l[2]||(l[2]=a=>G.value=a),d],"sort-by":P.value,"onUpdate:sortBy":[l[3]||(l[3]=a=>P.value=a),d],page:B.value,"onUpdate:page":[l[4]||(l[4]=a=>B.value=a),d],items:M.value,headers:I,loading:y.value,"items-length":n.value,search:v.value,hover:""},{top:f(()=>[t(te,{label:"搜尋","append-icon":"mdi-magnify",modelValue:v.value,"onUpdate:modelValue":l[1]||(l[1]=a=>v.value=a),"onClick:append":V,onKeydown:Oe(V,["enter"])},null,8,["modelValue"])]),"item.image":f(({item:a})=>[t(je,{src:a.image[0],height:"50px"},null,8,["src"])]),"item.sell":f(({item:a})=>[a.sell?(de(),Ke(la,{key:0,icon:"mdi-check"})):Je("",!0)]),"item.edit":f(({item:a})=>[t(X,{icon:"mdi-pencil",variant:"text",color:"blue",onClick:u=>k(a)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),t(qe,{modelValue:i.value,"onUpdate:modelValue":l[12]||(l[12]=a=>i.value=a),persistent:"",width:"500px"},{default:f(()=>[t(ua,{disabled:c(T),onSubmit:We(c(q),["prevent"])},{default:f(()=>[t(Qe,null,{default:f(()=>[t(Ye,null,{default:f(()=>[Z(Xe(r.value===""?"新增商品":"編輯商品"),1)]),_:1}),t(Ze,null,{default:f(()=>[t(te,{label:"名稱",modelValue:c(p).value.value,"onUpdate:modelValue":l[5]||(l[5]=a=>c(p).value.value=a),"error-messages":c(p).errorMessage.value},null,8,["modelValue","error-messages"]),t(te,{label:"價格",type:"number",min:"0",modelValue:c(b).value.value,"onUpdate:modelValue":l[6]||(l[6]=a=>c(b).value.value=a),"error-messages":c(b).errorMessage.value},null,8,["modelValue","error-messages"]),t(Ba,{label:"分類",items:F,modelValue:c(D).value.value,"onUpdate:modelValue":l[7]||(l[7]=a=>c(D).value.value=a),"error-messages":c(D).errorMessage.value},null,8,["modelValue","error-messages"]),t(Da,{label:"上架",modelValue:c(C).value.value,"onUpdate:modelValue":l[8]||(l[8]=a=>c(C).value.value=a),"error-messages":c(C).errorMessage.value},null,8,["modelValue","error-messages"]),t(Ma,{label:"說明",modelValue:c(h).value.value,"onUpdate:modelValue":l[9]||(l[9]=a=>c(h).value.value=a),"error-messages":c(h).errorMessage.value},null,8,["modelValue","error-messages"]),t(w,{modelValue:x.value,"onUpdate:modelValue":l[10]||(l[10]=a=>x.value=a),rawModelValue:N.value,"onUpdate:rawModelValue":l[11]||(l[11]=a=>N.value=a),accept:"image/jpeg,image/png",deletable:"","error-text":{type:"檔案格式不支援",size:"檔案超過 1MB 大小限制"},"help-text":"選擇檔案或拖曳到這裡","max-files":5,multiple:"","max-size":"1MB",ref_key:"fileAgent",ref:o},null,8,["modelValue","rawModelValue"])]),_:1}),t(ea,null,{default:f(()=>[t(aa),t(X,{color:"red",disabled:c(T),onClick:U},{default:f(()=>[Z("取消")]),_:1},8,["disabled"]),t(X,{color:"green",type:"submit",loading:c(T)},{default:f(()=>[Z("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64)}}};export{qa as default};
